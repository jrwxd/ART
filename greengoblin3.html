

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandarin Character Control (Cycling Input)</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #000;
        }

        #character-container {
            width: 100vw;
            height: 100vh;
            font-family: monospace;
            white-space: pre;
            overflow: hidden;
            font-size: 16px;
            line-height: 1.1;
            color: #00ff00;
        }

        #measure-span {
            position: absolute;
            visibility: hidden;
            height: auto;
            width: auto;
            white-space: nowrap;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
        }

        #controls {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #0f0;
            border-radius: 8px;
            font-family: monospace;
            color: #0f0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 250px;
        }
        #controls label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #controls input[type="range"] {
            width: 150px;
        }
        #controls .value-display {
            min-width: 40px;
            text-align: right;
        }
        #char-count-display {
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px dashed #0f0;
        }

    </style>
</head>
<body>

    <span id="measure-span"></span>

    <div id="controls">
        <div>
            <label>A: <input type="range" id="slider-a" min="-1" max="1" value="0.5" step="0.01"><span id="value-a" class="value-display">0.50</span></label>
        </div>
        <div>
            <label>C: <input type="range" id="slider-c" min="-0.5" max="0.5" value="0.05" step="0.001"><span id="value-c" class="value-display">0.050</span></label>
        </div>
        <div>
            <label>D: <input type="range" id="slider-d" min="-0.5" max="0.5" value="0.05" step="0.001"><span id="value-d" class="value-display">0.050</span></label>
        </div>
        <div>
            <label>E: <input type="range" id="slider-e" min="-2" max="2" value="1.0" step="0.01"><span id="value-e" class="value-display">1.00</span></label>
        </div>
        <div id="char-count-display">
            Chars: <span id="char-count">0</span>
        </div>
    </div>

    <div id="character-container"></div>

    <script>
        const container = document.getElementById('character-container');
        const measureSpan = document.getElementById('measure-span');
        let mandarinChars = "泠屮亇孑风上海市...-/|伤孑閹羪螜臱佈忇軅亇亇贔颗亇蛧砏汱宂彶泠屮噻蟣櫻鴈烪泠苶风亇泠厏蹗萺烪莟";

        let A, C, D, E;

        const sliderA = document.getElementById('slider-a');
        const sliderC = document.getElementById('slider-c');
        const sliderD = document.getElementById('slider-d');
        const sliderE = document.getElementById('slider-e');

        const valueA = document.getElementById('value-a');
        const valueC = document.getElementById('value-c');
        const valueD = document.getElementById('value-d');
        const valueE = document.getElementById('value-e');
        
        const charCountDisplay = document.getElementById('char-count');

        function updateVariablesFromControls() {
            A = parseFloat(sliderA.value);
            C = parseFloat(sliderC.value);
            D = parseFloat(sliderD.value);
            E = parseFloat(sliderE.value);
            
            valueA.textContent = A.toFixed(2);
            valueC.textContent = C.toFixed(3);
            valueD.textContent = D.toFixed(3);
            valueE.textContent = E.toFixed(2);
        }
        
        function updateCharCount() {
            charCountDisplay.textContent = mandarinChars.length;
        }
        
        /** MODIFIED: Handles key presses to cycle the character string */
        function handleKeyPress(event) {
            // Filter for single, printable characters.
            if (event.key.length === 1 && event.key !== ' ') {
                // Prepend the new character and remove the last character.
                mandarinChars = event.key + mandarinChars.slice(0, -1);
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => { clearTimeout(timeout); func(...args); };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        function getCharSize() {
            measureSpan.textContent = '0';
            const containerStyle = window.getComputedStyle(container);
            measureSpan.style.fontFamily = containerStyle.fontFamily;
            measureSpan.style.fontSize = containerStyle.fontSize;
            measureSpan.style.lineHeight = containerStyle.lineHeight;
            const rect = measureSpan.getBoundingClientRect();
            measureSpan.textContent = '';
            if (!rect.width || !rect.height) {
                const fontSize = parseFloat(containerStyle.fontSize) || 16;
                return { width: fontSize * 0.6, height: fontSize * 1.1 };
            }
            return { width: rect.width, height: rect.height };
        }
        
        function fillScreen() {
            const { width: charWidth, height: charHeight } = getCharSize();
            if (!charWidth || !charHeight) return;
            
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const cols = Math.floor(viewportWidth / charWidth);
            const rows = Math.floor(viewportHeight / charHeight);

            if (cols <= 0 || rows <= 0) { container.textContent = ''; return; }

            let content = '';
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const randomIndex = Math.abs(Math.floor(
                        (i * A * Math.sin(D * j) + E * i * Math.cos(C * i) + 1)
                    )) % mandarinChars.length;
                    content += mandarinChars[randomIndex];
                }
                if (i < rows - 1) {
                   content += '\n';
                }
            }
            container.textContent = content;
        }

        function initialize() {
            sliderA.addEventListener('input', updateVariablesFromControls);
            sliderC.addEventListener('input', updateVariablesFromControls);
            sliderD.addEventListener('input', updateVariablesFromControls);
            sliderE.addEventListener('input', updateVariablesFromControls);
            
            window.addEventListener('keydown', handleKeyPress);

            updateVariablesFromControls();
            updateCharCount(); // Set initial count

            fillScreen();
            setInterval(fillScreen, 100);

            window.addEventListener('resize', debounce(fillScreen, 150));
        }

        window.addEventListener('load', initialize);

    </script>
</body>
</html>

